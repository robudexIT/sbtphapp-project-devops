Parameters:
    DBInstanceID:
      Default: sbtphappdbinstances
      Description: My database instance
      Type: String
      MinLength: '1'
      MaxLength: '63'
      AllowedPattern: '[a-zA-Z][a-zA-Z0-9]*'
      ConstraintDescription: 
        Must begin with a letter and must not end with a hyphen or contain two
        consecutive hyphens.   
    DBName:
      Default: sbtphappdb
      Description: SBTPHAPP Database Name
      Type: String
      MinLength: '1'
      MaxLength: '64'
      AllowedPattern: '[a-zA-Z][a-zA-Z0-9]*'
      ConstraintDescription: Must begin with a letter and contain only alphanumeric characters.
    DBInstanceClass:
      Default: db.t3.micro
      Description: DB instance class
      Type: String
      ConstraintDescription: Must select a valid DB instance type.
    DBAllocatedStorage:
      Default: '20'
      Description: The size of the database (GiB)
      Type: Number
      MinValue: '20'
      MaxValue: '65536'
      ConstraintDescription: must be between 20 and 65536 GiB.
    DBUsername:
      Description: Username for MySQL database access
      Type: String
      MinLength: '1'
      MaxLength: '16'
      AllowedPattern: '[a-zA-Z][a-zA-Z0-9]*'
      ConstraintDescription: must begin with a letter and contain only alphanumeric characters.
    DBPassword:
      NoEcho: 'true'
      Description: Password MySQL database access
      Type: String
      MinLength: '8'
      MaxLength: '41'
      AllowedPattern: '[a-zA-Z0-9]*'
      ConstraintDescription: must contain only alphanumeric characters.
    DBSubnetGroupName:
      Type: String

    DatabaseSg:
      Type: AWS::EC2::SecurityGroup::Id 


Resources:
  PRIMARYRDS:
    Type: AWS::RDS::DBInstance
    Properties:
      DBInstanceIdentifier: !Ref DBInstanceID
      AllocatedStorage: !Ref DBAllocatedStorage
      BackupRetentionPeriod: 1
      DBInstanceClass: !Ref DBInstanceClass
      DBSubnetGroupName: !Ref DBSubnetGroupName
      DBName: !Ref DBName 
      Engine: mysql
      EngineVersion: "5.7.43"
      MasterUsername: !Ref  DBUsername
      MasterUserPassword:  !Ref DBPassword
      Port: 3306
      PubliclyAccessible: false
      VPCSecurityGroups: 
       - !Ref DatabaseSg

Outputs:

  RDSInstanceSourceDBIdentifier: 
    Description: Source DB Instance Identifier
    Value: !GetAtt PRIMARYRDS.DbiResourceId   
      
  PrimaryRdsDbInstanceArn:
    Description: Primary RDS Instance Arn 
    Value: !GetAtt PRIMARYRDS.DBInstanceArn
  
  PrimaryRdsDbInstanceAddress:
    Description: Primary RDS Instance Address 
    Value: !GetAtt  PRIMARYRDS.Endpoint.Address
  


  
    



      



        